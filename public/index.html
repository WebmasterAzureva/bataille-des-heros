<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‚öîÔ∏è Bataille des H√©ros - Multijoueur</title>
    <script src="/socket.io/socket.io.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Roboto:wght@400;700&display=swap');
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Roboto', sans-serif;
            background: radial-gradient(ellipse at center, #1a1a2e 0%, #0a0a15 70%);
            min-height: 100vh;
            color: white;
            overflow-x: hidden;
        }
        
        h1, h2, h3, .title-text { font-family: 'Cinzel', serif; }
        
        /* Lobby */
        .lobby {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
        }
        
        .lobby.hidden { display: none; }
        
        .lobby-title {
            font-size: 3em;
            color: #f1c40f;
            text-shadow: 0 0 30px rgba(241, 196, 15, 0.5);
            margin-bottom: 40px;
        }
        
        .lobby-box {
            background: linear-gradient(135deg, rgba(30, 30, 50, 0.95), rgba(20, 20, 35, 0.95));
            padding: 40px;
            border-radius: 20px;
            border: 3px solid #4a3f6b;
            box-shadow: 0 0 50px rgba(74, 63, 107, 0.5);
            text-align: center;
            min-width: 400px;
        }
        
        .lobby-btn {
            display: block;
            width: 100%;
            padding: 18px 30px;
            margin: 15px 0;
            font-size: 1.2em;
            font-weight: bold;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Cinzel', serif;
        }
        
        .lobby-btn:hover { transform: scale(1.05); }
        
        .btn-create {
            background: linear-gradient(135deg, #8a2be2, #9370db);
            color: white;
            box-shadow: 0 0 20px rgba(138, 43, 226, 0.5);
        }
        
        .btn-join {
            background: linear-gradient(135deg, #ff8c00, #ffa500);
            color: white;
            box-shadow: 0 0 20px rgba(255, 140, 0, 0.5);
        }
        
        .room-code-input {
            width: 100%;
            padding: 15px;
            font-size: 1.5em;
            text-align: center;
            border: 3px solid #4a3f6b;
            border-radius: 10px;
            background: rgba(0,0,0,0.3);
            color: white;
            margin: 15px 0;
            text-transform: uppercase;
            letter-spacing: 5px;
        }
        
        .room-code-display {
            font-size: 2.5em;
            color: #f1c40f;
            letter-spacing: 10px;
            margin: 20px 0;
            padding: 20px;
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
        }
        
        .waiting-text {
            color: #aaa;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        /* Game Container */
        .game-container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 10px;
        }
        
        .game-container.hidden { display: none; }
        
        /* Header */
        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 25px;
            background: linear-gradient(180deg, rgba(30,30,50,0.95), rgba(20,20,35,0.9));
            border-radius: 15px;
            margin-bottom: 15px;
            border: 2px solid #3a4a6a;
        }
        
        .player-panel {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .player-panel.opponent { flex-direction: row-reverse; }
        
        .player-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2em;
            position: relative;
        }
        
        .player-avatar.me {
            background: linear-gradient(135deg, #8a2be2, #4a0080);
            border: 3px solid #9370db;
            box-shadow: 0 0 20px rgba(138, 43, 226, 0.5);
        }
        
        .player-avatar.opponent-avatar {
            background: linear-gradient(135deg, #ff8c00, #8b4513);
            border: 3px solid #ffa500;
            box-shadow: 0 0 20px rgba(255, 140, 0, 0.5);
        }
        
        .ready-indicator {
            position: absolute;
            bottom: -5px;
            right: -5px;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #7f8c8d;
            border: 2px solid white;
        }
        
        .ready-indicator.ready { background: #27ae60; }
        
        .player-info {
            text-align: left;
        }
        
        .player-panel.opponent .player-info { text-align: right; }
        
        .player-name {
            font-family: 'Cinzel', serif;
            font-size: 1.2em;
            font-weight: bold;
        }
        
        .player-name.me-name { color: #9370db; }
        .player-name.opponent-name { color: #ffa500; }
        
        .hp-bar {
            width: 150px;
            height: 25px;
            background: rgba(0,0,0,0.5);
            border-radius: 15px;
            overflow: hidden;
            position: relative;
            border: 2px solid #333;
        }
        
        .hp-fill {
            height: 100%;
            background: linear-gradient(90deg, #c0392b, #e74c3c);
            transition: width 0.5s ease;
            position: relative;
        }
        
        .hp-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 50%;
            background: linear-gradient(180deg, rgba(255,255,255,0.3), transparent);
        }
        
        .hp-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-weight: bold;
            text-shadow: 1px 1px 2px black;
            font-size: 0.9em;
        }
        
        .energy-display {
            display: flex;
            gap: 5px;
            margin-top: 5px;
        }
        
        .energy-gem {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, #00d4ff, #006688);
            border: 2px solid #00ffff;
            box-shadow: 0 0 8px rgba(0, 212, 255, 0.6);
        }
        
        .energy-gem.empty {
            background: #333;
            border-color: #555;
            box-shadow: none;
        }
        
        /* Timer */
        .timer-container {
            text-align: center;
        }
        
        .turn-display {
            font-family: 'Cinzel', serif;
            font-size: 0.9em;
            color: #f1c40f;
            margin-bottom: 5px;
        }
        
        .timer-circle {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: conic-gradient(#f1c40f var(--progress, 100%), #333 0%);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto;
            position: relative;
        }
        
        .timer-inner {
            width: 65px;
            height: 65px;
            border-radius: 50%;
            background: #1a1a2e;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8em;
            font-weight: bold;
        }
        
        .timer-inner.warning { color: #e74c3c; animation: timerPulse 0.5s infinite; }
        
        @keyframes timerPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        .phase-text {
            font-size: 0.8em;
            margin-top: 8px;
            color: #aaa;
            text-transform: uppercase;
        }
        
        .phase-text.resolution { color: #f1c40f; font-weight: bold; }
        
        /* Game Area */
        .game-area {
            display: flex;
            justify-content: center;
            align-items: stretch;
            gap: 20px;
            margin-bottom: 15px;
        }
        
        /* Side panels */
        .side-panel {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            min-width: 100px;
        }
        
        .deck-visual {
            width: 80px;
            height: 110px;
            position: relative;
            perspective: 500px;
        }
        
        .deck-card-back {
            width: 100%;
            height: 100%;
            position: absolute;
            border-radius: 8px;
            background: linear-gradient(135deg, #2a2a4a, #1a1a2e);
            border: 2px solid #4a4a6a;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2em;
            transform-style: preserve-3d;
        }
        
        .deck-card-back.me-deck {
            background: linear-gradient(135deg, #4a0080, #8a2be2);
            border-color: #9370db;
        }
        
        .deck-card-back.opponent-deck {
            background: linear-gradient(135deg, #8b4513, #cd853f);
            border-color: #daa520;
        }
        
        .deck-card-back:nth-child(1) { top: 0; left: 0; }
        .deck-card-back:nth-child(2) { top: 3px; left: 3px; }
        .deck-card-back:nth-child(3) { top: 6px; left: 6px; }
        
        .deck-count {
            font-size: 0.85em;
            color: #888;
        }
        
        /* Battlefield */
        .battlefield {
            flex: 1;
            max-width: 750px;
            background: linear-gradient(180deg, rgba(20, 25, 40, 0.95) 0%, rgba(30, 40, 60, 0.9) 50%, rgba(20, 25, 40, 0.95) 100%);
            border-radius: 15px;
            padding: 20px 25px;
            border: 2px solid #3a4a6a;
            box-shadow: inset 0 0 80px rgba(0,0,0,0.6), 0 0 30px rgba(58, 74, 106, 0.3);
            position: relative;
        }
        
        .battlefield::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: url("data:image/svg+xml,%3Csvg width='40' height='40' viewBox='0 0 40 40' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M20 0L40 20L20 40L0 20z' fill='none' stroke='rgba(255,255,255,0.02)' stroke-width='1'/%3E%3C/svg%3E");
            pointer-events: none;
        }
        
        .battlefield-content {
            position: relative;
            z-index: 1;
        }
        
        .battlefield-header {
            display: grid;
            grid-template-columns: 95px 95px 60px 60px 95px 95px;
            gap: 12px;
            text-align: center;
            font-size: 0.75em;
            margin-bottom: 10px;
            color: rgba(255,255,255,0.5);
        }
        
        .header-me { color: #9370db; }
        .header-opponent { color: #ffa500; }
        .header-trap { color: #f1c40f; }
        
        .battlefield-row {
            display: grid;
            grid-template-columns: 95px 95px 60px 60px 95px 95px;
            gap: 12px;
            margin-bottom: 10px;
            align-items: center;
            justify-items: center;
        }
        
        /* Card Slots */
        .card-slot {
            width: 95px;
            height: 115px;
            border: 2px dashed rgba(255,255,255,0.15);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: rgba(255,255,255,0.02);
            position: relative;
        }
        
        .card-slot:hover {
            border-color: rgba(241, 196, 15, 0.6);
            background: rgba(241, 196, 15, 0.05);
        }
        
        .card-slot.me-slot { border-color: rgba(138, 43, 226, 0.3); }
        .card-slot.opponent-slot { border-color: rgba(255, 140, 0, 0.3); }
        
        .card-slot.has-card { border-style: solid; background: transparent; }
        .card-slot.selected { border-color: #f1c40f !important; box-shadow: 0 0 25px rgba(241, 196, 15, 0.6); }
        .card-slot.targetable { border-color: #e74c3c !important; animation: targetGlow 1s infinite; }
        
        @keyframes targetGlow {
            0%, 100% { box-shadow: 0 0 10px rgba(231, 76, 60, 0.5); }
            50% { box-shadow: 0 0 25px rgba(231, 76, 60, 0.8); }
        }
        
        /* Trap Slots */
        .trap-slot {
            width: 50px;
            height: 50px;
            border: 2px dashed rgba(255,255,255,0.2);
            transform: rotate(45deg);
            cursor: pointer;
            transition: all 0.3s;
            background: rgba(0,0,0,0.3);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .trap-slot-inner {
            transform: rotate(-45deg);
            font-size: 1.2em;
        }
        
        .trap-slot:hover { border-color: #f1c40f; background: rgba(241, 196, 15, 0.2); }
        .trap-slot.me-trap { border-color: rgba(138, 43, 226, 0.4); }
        .trap-slot.opponent-trap { border-color: rgba(255, 140, 0, 0.4); }
        .trap-slot.has-trap { border-style: solid; background: rgba(231, 76, 60, 0.3); }
        
        /* Cards */
        .card {
            width: 91px;
            height: 111px;
            border-radius: 6px;
            position: relative;
            cursor: pointer;
            transition: all 0.2s;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.4);
        }
        
        .card:hover { transform: scale(1.08); z-index: 10; }
        
        .card-cost {
            position: absolute;
            top: 2px;
            left: 2px;
            width: 22px;
            height: 22px;
            background: radial-gradient(circle at 30% 30%, #00d4ff, #006688);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75em;
            font-weight: bold;
            border: 2px solid #00ffff;
            z-index: 5;
            box-shadow: 0 0 8px rgba(0, 212, 255, 0.5);
        }
        
        .card-art {
            width: 100%;
            height: 55px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2em;
            position: relative;
        }
        
        .card.creature .card-art { background: linear-gradient(180deg, #2a3a5a, #1a2535); }
        .card.spell .card-art { background: linear-gradient(180deg, #5a2a7a, #3a1a5a); }
        .card.trap-card .card-art { background: linear-gradient(180deg, #7a2a2a, #5a1a1a); }
        
        .card-info {
            background: linear-gradient(180deg, #2c3e50, #1a252f);
            padding: 4px;
            height: 56px;
        }
        
        .card-name {
            font-size: 0.55em;
            font-weight: bold;
            text-align: center;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .card-abilities {
            display: flex;
            gap: 2px;
            justify-content: center;
            font-size: 0.7em;
            margin: 2px 0;
        }
        
        .card-stats {
            display: flex;
            justify-content: space-between;
            padding: 0 5px;
        }
        
        .stat-badge {
            font-size: 0.8em;
            font-weight: bold;
            padding: 2px 8px;
            border-radius: 4px;
        }
        
        .stat-atk { background: linear-gradient(135deg, #c0392b, #e74c3c); }
        .stat-hp { background: linear-gradient(135deg, #27ae60, #2ecc71); }
        .stat-hp.damaged { background: linear-gradient(135deg, #e74c3c, #c0392b); }
        
        .card.creature { border: 2px solid #3498db; }
        .card.spell { border: 2px solid #9b59b6; }
        .card.trap-card { border: 2px solid #e74c3c; }
        
        .card.just-played { opacity: 0.7; }
        .card.just-played::after { content: 'üí§'; position: absolute; top: 2px; right: 2px; font-size: 0.7em; }
        .card.can-attack { box-shadow: 0 0 20px rgba(231, 76, 60, 0.7); }
        .card.moved::before { content: '‚úì'; position: absolute; top: 2px; right: 2px; font-size: 0.6em; background: #27ae60; border-radius: 50%; width: 14px; height: 14px; display: flex; align-items: center; justify-content: center; }
        .card.unplayable { opacity: 0.4; filter: grayscale(60%); }
        
        /* Animations */
        .card.attacking { animation: attack 0.5s ease-in-out; }
        @keyframes attack { 0% { transform: translateX(0); } 50% { transform: translateX(30px) scale(1.1); } 100% { transform: translateX(0); } }
        
        .card.hit { animation: hit 0.4s; }
        @keyframes hit { 0%, 100% { filter: brightness(1); } 50% { filter: brightness(2) saturate(0); } }
        
        .card.dying { animation: die 0.6s forwards; }
        @keyframes die { 0% { transform: scale(1); opacity: 1; } 100% { transform: scale(0) rotate(180deg); opacity: 0; } }
        
        .floating-text {
            position: absolute;
            font-size: 1.4em;
            font-weight: bold;
            pointer-events: none;
            z-index: 100;
            animation: float 1s ease-out forwards;
            text-shadow: 2px 2px 4px black;
        }
        
        .floating-text.damage { color: #e74c3c; }
        .floating-text.heal { color: #2ecc71; }
        
        @keyframes float { 0% { opacity: 1; transform: translateY(0); } 100% { opacity: 0; transform: translateY(-50px); } }
        
        /* Hand */
        .hand-container {
            background: linear-gradient(180deg, rgba(20,20,35,0.98), rgba(10,10,20,0.98));
            border-radius: 15px 15px 0 0;
            padding: 15px 20px;
            border: 2px solid #3a4a6a;
            border-bottom: none;
        }
        
        .hand-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .hand-title { font-family: 'Cinzel', serif; color: #f1c40f; }
        
        .hand-cards {
            display: flex;
            gap: 10px;
            min-height: 120px;
            padding: 12px;
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .hand-card { transition: all 0.2s; }
        .hand-card:hover { transform: translateY(-20px) scale(1.1); z-index: 10; }
        .hand-card.selected { transform: translateY(-30px) scale(1.15); box-shadow: 0 25px 50px rgba(241, 196, 15, 0.6); }
        
        /* Action Button */
        .action-panel {
            display: flex;
            justify-content: center;
            margin: 15px 0;
        }
        
        .ready-btn {
            padding: 15px 50px;
            font-size: 1.2em;
            font-weight: bold;
            font-family: 'Cinzel', serif;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
            box-shadow: 0 5px 20px rgba(39, 174, 96, 0.4);
            text-transform: uppercase;
        }
        
        .ready-btn:hover { transform: scale(1.05); }
        .ready-btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
        .ready-btn.is-ready { background: linear-gradient(135deg, #7f8c8d, #95a5a6); }
        
        /* Log */
        .combat-log {
            background: rgba(0,0,0,0.5);
            border-radius: 10px;
            padding: 15px;
            max-height: 120px;
            overflow-y: auto;
            border: 1px solid #3a4a6a;
        }
        
        .log-entry {
            padding: 4px 10px;
            margin-bottom: 3px;
            border-radius: 4px;
            font-size: 0.8em;
        }
        
        .log-phase { background: rgba(241, 196, 15, 0.2); color: #f1c40f; }
        .log-action { background: rgba(52, 152, 219, 0.2); color: #5dade2; }
        .log-damage { background: rgba(231, 76, 60, 0.2); color: #ec7063; }
        .log-heal { background: rgba(46, 204, 113, 0.2); color: #58d68d; }
        .log-trap { background: rgba(155, 89, 182, 0.2); color: #bb8fce; }
        
        /* Selection Info */
        .selection-info {
            text-align: center;
            padding: 10px;
            margin-bottom: 10px;
            background: rgba(155, 89, 182, 0.3);
            border-radius: 8px;
            border: 1px solid #9b59b6;
            display: none;
        }
        
        .selection-info.active { display: block; }
        
        /* Game Over */
        .game-over-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .game-over-overlay.hidden { display: none; }
        
        .game-over-content {
            text-align: center;
            padding: 50px;
            background: linear-gradient(135deg, rgba(40,40,60,0.95), rgba(20,20,35,0.95));
            border-radius: 20px;
            border: 4px solid #f1c40f;
        }
        
        .game-over-title {
            font-family: 'Cinzel', serif;
            font-size: 3em;
            color: #f1c40f;
            margin-bottom: 20px;
        }
        
        .game-over-result {
            font-size: 1.5em;
            margin-bottom: 30px;
        }
        
        .game-over-result.victory { color: #2ecc71; }
        .game-over-result.defeat { color: #e74c3c; }
    </style>
</head>
<body>
    <!-- Lobby -->
    <div class="lobby" id="lobby">
        <h1 class="lobby-title">‚öîÔ∏è Bataille des H√©ros</h1>
        <div class="lobby-box" id="lobby-menu">
            <h2 style="margin-bottom: 30px; color: #f1c40f;">Multijoueur</h2>
            <button class="lobby-btn btn-create" onclick="createRoom()">üéÆ Cr√©er une partie</button>
            <div style="margin: 20px 0; color: #666;">‚Äî ou ‚Äî</div>
            <input type="text" class="room-code-input" id="room-code-input" placeholder="CODE" maxlength="6">
            <button class="lobby-btn btn-join" onclick="joinRoom()">üö™ Rejoindre</button>
        </div>
        <div class="lobby-box hidden" id="lobby-waiting">
            <h2 style="color: #f1c40f; margin-bottom: 20px;">Partie cr√©√©e !</h2>
            <p style="color: #aaa; margin-bottom: 10px;">Code de la partie :</p>
            <div class="room-code-display" id="room-code-display">------</div>
            <p class="waiting-text">En attente d'un adversaire...</p>
        </div>
    </div>

    <!-- Game -->
    <div class="game-container hidden" id="game-container">
        <div class="game-header">
            <div class="player-panel me-panel">
                <div class="player-avatar me">üßô‚Äç‚ôÇÔ∏è<div class="ready-indicator" id="me-ready"></div></div>
                <div class="player-info">
                    <div class="player-name me-name">Vous (J<span id="my-player-num">1</span>)</div>
                    <div class="hp-bar">
                        <div class="hp-fill" id="me-hp-fill" style="width: 100%"></div>
                        <div class="hp-text"><span id="me-hp">20</span>/20</div>
                    </div>
                    <div class="energy-display" id="me-energy"></div>
                </div>
            </div>
            
            <div class="timer-container">
                <div class="turn-display">TOUR <span id="turn-num">1</span></div>
                <div class="timer-circle" id="timer-circle">
                    <div class="timer-inner" id="timer-text">60</div>
                </div>
                <div class="phase-text" id="phase-text">PLANIFICATION</div>
            </div>
            
            <div class="player-panel opponent">
                <div class="player-avatar opponent-avatar">‚öîÔ∏è<div class="ready-indicator" id="opponent-ready"></div></div>
                <div class="player-info">
                    <div class="player-name opponent-name">Adversaire</div>
                    <div class="hp-bar">
                        <div class="hp-fill" id="opponent-hp-fill" style="width: 100%"></div>
                        <div class="hp-text"><span id="opponent-hp">20</span>/20</div>
                    </div>
                    <div class="energy-display" id="opponent-energy"></div>
                </div>
            </div>
        </div>
        
        <div class="selection-info" id="selection-info">
            <span id="selection-text">S√©lectionnez une cible...</span>
        </div>
        
        <div class="game-area">
            <div class="side-panel">
                <div class="deck-visual">
                    <div class="deck-card-back me-deck">üÉè</div>
                    <div class="deck-card-back me-deck">üÉè</div>
                    <div class="deck-card-back me-deck">üÉè</div>
                </div>
                <div class="deck-count"><span id="me-deck-count">53</span> cartes</div>
            </div>
            
            <div class="battlefield">
                <div class="battlefield-content">
                    <div class="battlefield-header">
                        <span class="header-me">Arri√®re</span>
                        <span class="header-me">Avant</span>
                        <span class="header-trap">ü™§</span>
                        <span class="header-trap">ü™§</span>
                        <span class="header-opponent">Avant</span>
                        <span class="header-opponent">Arri√®re</span>
                    </div>
                    <div id="battlefield-rows"></div>
                </div>
            </div>
            
            <div class="side-panel">
                <div class="deck-visual">
                    <div class="deck-card-back opponent-deck">üÉè</div>
                    <div class="deck-card-back opponent-deck">üÉè</div>
                    <div class="deck-card-back opponent-deck">üÉè</div>
                </div>
                <div class="deck-count"><span id="opponent-deck-count">53</span> cartes</div>
            </div>
        </div>
        
        <div class="hand-container">
            <div class="hand-header">
                <span class="hand-title" id="hand-title">üé¥ Votre main</span>
                <span id="hand-count">7 cartes</span>
            </div>
            <div class="hand-cards" id="hand-cards"></div>
        </div>
        
        <div class="action-panel">
            <button class="ready-btn" id="ready-btn" onclick="toggleReady()">‚úÖ PR√äT</button>
        </div>
        
        <div class="combat-log">
            <div id="combat-log"></div>
        </div>
    </div>
    
    <!-- Game Over -->
    <div class="game-over-overlay hidden" id="game-over">
        <div class="game-over-content">
            <div class="game-over-title">üèÜ Partie termin√©e</div>
            <div class="game-over-result" id="game-over-result">Victoire !</div>
            <button class="lobby-btn btn-create" onclick="location.reload()">üîÑ Nouvelle partie</button>
        </div>
    </div>

    <script>
        let socket;
        let myPlayerNum = 0;
        let gameState = null;
        let selectedCard = null;
        let selectedSlot = null;
        let targetingMode = null;
        
        // ==================== CONNECTION ====================
        function initSocket() {
            socket = io();
            
            socket.on('gameStart', (state) => {
                gameState = state;
                document.getElementById('lobby').classList.add('hidden');
                document.getElementById('game-container').classList.remove('hidden');
                initBattlefield();
                updateUI();
                log('üéÆ La partie commence !', 'phase');
            });
            
            socket.on('gameStateUpdate', (state) => {
                gameState = state;
                updateUI();
            });
            
            socket.on('timerUpdate', (time) => {
                if (gameState) gameState.timeLeft = time;
                updateTimer(time);
            });
            
            socket.on('phaseChange', (phase) => {
                if (gameState) gameState.phase = phase;
                updatePhase(phase);
            });
            
            socket.on('playerReady', (playerNum) => {
                const isMe = playerNum === myPlayerNum;
                document.getElementById(isMe ? 'me-ready' : 'opponent-ready').classList.add('ready');
                log(`${isMe ? 'Vous √™tes' : 'L\'adversaire est'} pr√™t`, 'action');
            });
            
            socket.on('newTurn', (data) => {
                document.getElementById('turn-num').textContent = data.turn;
                document.getElementById('me-ready').classList.remove('ready');
                document.getElementById('opponent-ready').classList.remove('ready');
                document.getElementById('ready-btn').classList.remove('is-ready');
                document.getElementById('ready-btn').disabled = false;
                document.getElementById('ready-btn').textContent = '‚úÖ PR√äT';
                log(`üéÆ Tour ${data.turn} (‚ö°${data.maxEnergy})`, 'phase');
            });
            
            socket.on('resolutionLog', (data) => {
                log(data.msg, data.type);
            });
            
            socket.on('spellEffect', (data) => {
                const slot = document.querySelector(`.card-slot[data-owner="${data.player === myPlayerNum ? 'me' : 'opponent'}"][data-row="${data.row}"][data-col="${data.col}"]`);
                if (slot) showFloatingText(slot, data.type === 'damage' ? `-${data.amount}` : '+3', data.type);
            });
            
            socket.on('cardDeath', (data) => {
                const slot = document.querySelector(`.card-slot[data-owner="${data.player === myPlayerNum ? 'me' : 'opponent'}"][data-row="${data.row}"][data-col="${data.col}"]`);
                const card = slot?.querySelector('.card');
                if (card) card.classList.add('dying');
            });
            
            socket.on('directDamage', (data) => {
                const isMe = data.defender === myPlayerNum;
                const hpEl = document.getElementById(isMe ? 'me-hp-fill' : 'opponent-hp-fill');
                hpEl.style.transition = 'none';
                hpEl.style.background = '#ff0000';
                setTimeout(() => {
                    hpEl.style.transition = 'all 0.3s';
                    hpEl.style.background = '';
                }, 200);
            });
            
            socket.on('combat', (data) => {
                // Animation de combat
            });
            
            socket.on('gameOver', (data) => {
                const won = data.winner === myPlayerNum;
                document.getElementById('game-over-result').textContent = won ? 'üéâ Victoire !' : 'üò¢ D√©faite';
                document.getElementById('game-over-result').className = `game-over-result ${won ? 'victory' : 'defeat'}`;
                document.getElementById('game-over').classList.remove('hidden');
            });
            
            socket.on('playerDisconnected', (playerNum) => {
                log(`‚ö†Ô∏è Joueur ${playerNum} d√©connect√©`, 'damage');
            });
        }
        
        // ==================== LOBBY ====================
        function createRoom() {
            socket.emit('createRoom', (response) => {
                if (response.success) {
                    myPlayerNum = response.playerNum;
                    document.getElementById('my-player-num').textContent = myPlayerNum;
                    document.getElementById('room-code-display').textContent = response.code;
                    document.getElementById('lobby-menu').classList.add('hidden');
                    document.getElementById('lobby-waiting').classList.remove('hidden');
                }
            });
        }
        
        function joinRoom() {
            const code = document.getElementById('room-code-input').value.trim();
            if (!code) return;
            
            socket.emit('joinRoom', code, (response) => {
                if (response.success) {
                    myPlayerNum = response.playerNum;
                    document.getElementById('my-player-num').textContent = myPlayerNum;
                } else {
                    alert(response.error);
                }
            });
        }
        
        // ==================== BATTLEFIELD ====================
        function initBattlefield() {
            const container = document.getElementById('battlefield-rows');
            container.innerHTML = '';
            
            for (let row = 0; row < 4; row++) {
                const rowEl = document.createElement('div');
                rowEl.className = 'battlefield-row';
                
                // Me back
                rowEl.appendChild(createSlot('me', row, 1, 'back-row'));
                // Me front
                rowEl.appendChild(createSlot('me', row, 0, 'front-row'));
                // Me trap
                rowEl.appendChild(createTrapSlot('me', row));
                // Opponent trap
                rowEl.appendChild(createTrapSlot('opponent', row));
                // Opponent front
                rowEl.appendChild(createSlot('opponent', row, 0, 'front-row'));
                // Opponent back
                rowEl.appendChild(createSlot('opponent', row, 1, 'back-row'));
                
                container.appendChild(rowEl);
            }
        }
        
        function createSlot(owner, row, col, type) {
            const slot = document.createElement('div');
            slot.className = `card-slot ${owner}-slot ${type}`;
            slot.dataset.owner = owner;
            slot.dataset.row = row;
            slot.dataset.col = col;
            slot.onclick = () => handleSlotClick(owner, row, col);
            return slot;
        }
        
        function createTrapSlot(owner, row) {
            const slot = document.createElement('div');
            slot.className = `trap-slot ${owner}-trap`;
            slot.dataset.owner = owner;
            slot.dataset.trap = row;
            slot.innerHTML = '<span class="trap-slot-inner">ü™§</span>';
            slot.onclick = () => handleTrapClick(owner, row);
            return slot;
        }
        
        // ==================== UI UPDATE ====================
        function updateUI() {
            if (!gameState) return;
            
            const me = gameState.me;
            const opp = gameState.opponent;
            
            // HP
            document.getElementById('me-hp').textContent = me.hp;
            document.getElementById('me-hp-fill').style.width = `${(me.hp / 20) * 100}%`;
            document.getElementById('opponent-hp').textContent = opp.hp;
            document.getElementById('opponent-hp-fill').style.width = `${(opp.hp / 20) * 100}%`;
            
            // Energy
            updateEnergy('me', me.energy, me.maxEnergy);
            updateEnergy('opponent', opp.energy, opp.maxEnergy);
            
            // Deck
            document.getElementById('me-deck-count').textContent = me.deckCount;
            document.getElementById('opponent-deck-count').textContent = opp.deckCount;
            
            // Field
            updateField('me', me.field);
            updateField('opponent', opp.field);
            
            // Traps
            updateTraps('me', me.traps);
            updateTraps('opponent', opp.trapsCount);
            
            // Hand
            updateHand(me.hand, me.energy);
            
            // Ready state
            if (me.ready) {
                document.getElementById('me-ready').classList.add('ready');
                document.getElementById('ready-btn').classList.add('is-ready');
                document.getElementById('ready-btn').textContent = '‚è≥ EN ATTENTE';
            }
            if (opp.ready) {
                document.getElementById('opponent-ready').classList.add('ready');
            }
        }
        
        function updateEnergy(who, current, max) {
            const container = document.getElementById(`${who}-energy`);
            container.innerHTML = '';
            for (let i = 0; i < max; i++) {
                const gem = document.createElement('div');
                gem.className = `energy-gem ${i < current ? '' : 'empty'}`;
                container.appendChild(gem);
            }
        }
        
        function updateField(owner, field) {
            for (let row = 0; row < 4; row++) {
                for (let col = 0; col < 2; col++) {
                    const slot = document.querySelector(`.card-slot[data-owner="${owner}"][data-row="${row}"][data-col="${col}"]`);
                    if (!slot) continue;
                    
                    slot.querySelector('.card')?.remove();
                    slot.classList.remove('has-card');
                    
                    const card = field[row][col];
                    if (card) {
                        slot.classList.add('has-card');
                        slot.appendChild(createCardElement(card, false, owner === 'me'));
                    }
                }
            }
        }
        
        function updateTraps(owner, data) {
            if (owner === 'me') {
                data.forEach((trap, i) => {
                    const slot = document.querySelector(`.trap-slot[data-owner="me"][data-trap="${i}"]`);
                    if (slot) {
                        slot.classList.toggle('has-trap', !!trap);
                        slot.querySelector('.trap-slot-inner').textContent = trap ? 'üí£' : 'ü™§';
                    }
                });
            } else {
                // Opponent: just show count
                document.querySelectorAll('.trap-slot[data-owner="opponent"]').forEach((slot, i) => {
                    slot.classList.toggle('has-trap', i < data);
                    slot.querySelector('.trap-slot-inner').textContent = i < data ? '‚ùì' : 'ü™§';
                });
            }
        }
        
        function updateHand(hand, energy) {
            const container = document.getElementById('hand-cards');
            container.innerHTML = '';
            
            hand.forEach((card, i) => {
                const el = createCardElement(card, true, true);
                el.classList.add('hand-card');
                if (card.cost > energy) el.classList.add('unplayable');
                el.onclick = () => selectHandCard(i);
                container.appendChild(el);
            });
            
            document.getElementById('hand-count').textContent = `${hand.length} cartes`;
        }
        
        function createCardElement(card, inHand, isMine) {
            const el = document.createElement('div');
            el.className = `card ${card.type === 'trap' ? 'trap-card' : card.type}`;
            
            if (!inHand && card.type === 'creature') {
                if (card.turnsOnField === 0 && !card.abilities?.includes('haste')) el.classList.add('just-played');
                if (card.canAttack) el.classList.add('can-attack');
                if (card.movedThisTurn) el.classList.add('moved');
            }
            
            const icons = { fly: 'ü¶Ö', shooter: 'üéØ', haste: '‚ö°' };
            const abilities = (card.abilities || []).map(a => icons[a] || '').join(' ');
            const hp = card.currentHp ?? card.hp;
            const hpClass = card.type === 'creature' && hp < card.hp ? 'damaged' : '';
            
            el.innerHTML = `
                <div class="card-cost">${card.cost}</div>
                <div class="card-art">${card.icon || '‚ùì'}</div>
                <div class="card-info">
                    <div class="card-name">${card.name}</div>
                    <div class="card-abilities">${abilities || (card.type === 'spell' ? (card.offensive ? '‚öîÔ∏è' : 'üõ°Ô∏è') : '')}</div>
                    <div class="card-stats">
                        ${card.atk !== undefined ? `<span class="stat-badge stat-atk">${card.atk}</span>` : ''}
                        ${card.damage ? `<span class="stat-badge stat-atk">${card.damage}</span>` : ''}
                        ${card.heal ? `<span class="stat-badge stat-hp">${card.heal}</span>` : ''}
                        ${card.type === 'creature' ? `<span class="stat-badge stat-hp ${hpClass}">${hp}</span>` : ''}
                    </div>
                </div>
            `;
            return el;
        }
        
        function updateTimer(time) {
            const timerText = document.getElementById('timer-text');
            const timerCircle = document.getElementById('timer-circle');
            
            timerText.textContent = time;
            timerCircle.style.setProperty('--progress', `${(time / 60) * 100}%`);
            
            if (time <= 10) {
                timerText.classList.add('warning');
            } else {
                timerText.classList.remove('warning');
            }
        }
        
        function updatePhase(phase) {
            const phaseText = document.getElementById('phase-text');
            if (phase === 'resolution') {
                phaseText.textContent = 'R√âSOLUTION';
                phaseText.classList.add('resolution');
                document.getElementById('ready-btn').disabled = true;
            } else {
                phaseText.textContent = 'PLANIFICATION';
                phaseText.classList.remove('resolution');
            }
        }
        
        // ==================== INTERACTIONS ====================
        function selectHandCard(index) {
            if (gameState.phase !== 'planning' || gameState.me.ready) return;
            
            clearSelections();
            const card = gameState.me.hand[index];
            if (card.cost > gameState.me.energy) return;
            
            selectedCard = { ...card, handIndex: index };
            document.querySelectorAll('.hand-card')[index]?.classList.add('selected');
            
            if (card.type === 'spell') {
                targetingMode = 'spell';
                document.querySelectorAll('.card-slot').forEach(s => s.classList.add('targetable'));
                showInfo(`üéØ ${card.name}: Cliquez sur une cible`);
            } else if (card.type === 'creature') {
                showInfo(`üé¥ ${card.name}: Cliquez pour poser`);
            } else if (card.type === 'trap') {
                showInfo(`ü™§ ${card.name}: Cliquez sur un emplacement pi√®ge`);
            }
        }
        
        function handleSlotClick(owner, row, col) {
            if (gameState.phase !== 'planning' || gameState.me.ready) return;
            
            // Spell targeting
            if (targetingMode === 'spell' && selectedCard) {
                const targetPlayer = owner === 'me' ? myPlayerNum : (myPlayerNum === 1 ? 2 : 1);
                socket.emit('castSpell', { handIndex: selectedCard.handIndex, targetPlayer, row, col });
                clearSelections();
                return;
            }
            
            // Only interact with own slots for placement/movement
            if (owner !== 'me') return;
            
            // Place creature
            if (selectedCard && selectedCard.type === 'creature') {
                socket.emit('placeCard', { handIndex: selectedCard.handIndex, row, col });
                clearSelections();
                return;
            }
            
            // Movement
            const card = gameState.me.field[row][col];
            if (selectedSlot) {
                socket.emit('moveCard', { fromRow: selectedSlot.row, fromCol: selectedSlot.col, toRow: row, toCol: col });
                clearSelections();
            } else if (card && !card.movedThisTurn) {
                selectedSlot = { row, col };
                document.querySelector(`.card-slot[data-owner="me"][data-row="${row}"][data-col="${col}"]`)?.classList.add('selected');
                showInfo(`üîÑ ${card.name}: Cliquez sur une case adjacente`);
            }
        }
        
        function handleTrapClick(owner, trapIndex) {
            if (gameState.phase !== 'planning' || gameState.me.ready || owner !== 'me') return;
            
            if (selectedCard && selectedCard.type === 'trap') {
                socket.emit('placeTrap', { handIndex: selectedCard.handIndex, trapIndex });
                clearSelections();
            }
        }
        
        function toggleReady() {
            if (gameState.phase !== 'planning' || gameState.me.ready) return;
            socket.emit('ready');
        }
        
        function clearSelections() {
            selectedCard = null;
            selectedSlot = null;
            targetingMode = null;
            document.querySelectorAll('.hand-card, .card-slot').forEach(e => e.classList.remove('selected', 'targetable'));
            document.getElementById('selection-info').classList.remove('active');
        }
        
        function showInfo(text) {
            document.getElementById('selection-text').textContent = text;
            document.getElementById('selection-info').classList.add('active');
        }
        
        function showFloatingText(slot, text, type) {
            const el = document.createElement('div');
            el.className = `floating-text ${type}`;
            el.textContent = text;
            slot.appendChild(el);
            setTimeout(() => el.remove(), 1000);
        }
        
        function log(msg, type = 'action') {
            const el = document.createElement('div');
            el.className = `log-entry log-${type}`;
            el.textContent = msg;
            const container = document.getElementById('combat-log');
            container.appendChild(el);
            container.scrollTop = container.scrollHeight;
        }
        
        // ==================== INIT ====================
        document.addEventListener('DOMContentLoaded', () => {
            initSocket();
            
            document.getElementById('room-code-input').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') joinRoom();
            });
        });
    </script>
</body>
</html>
